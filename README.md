# 短期记忆 📝

> 补全 AI 的短期记忆连续性。记住最近 1-3 天的对话，让 AI 像真实的人一样自然接上之前的话题，而不是每次都像陌生人一样重新开始。

**Author**: 言柒  
**GitHub**: [continuous_diary](https://github.com/tt-P607/continuous_diary)

---

## 为什么需要这个？

### 问题
- ❌ AI 只能看到最近的 N 条消息
- ❌ 前几天说过的事情，都忘了
- ❌ 每次都得重新解释背景
- ❌ 没有"真实记忆"的感觉

### 解决方案
- ✅ 自动记住最近 **3 天** 的对话
- ✅ 用 **第一人称** 记录（像日记一样）
- ✅ 每次回复 **自动注入** 记忆内容
- ✅ AI 自然接上之前的话题，毫无违和感

---

## 怎么用？

### 开箱即用
安装后无需配置，自动生效。插件会：

1. **累积消息** → 收集最近的对话
2. **自动触发** → 达到条件时生成记忆总结
3. **注入提示词** → 下次 AI 回复时，自动融入这些记忆
4. **每日更新** → 每天零点自动转成"昨天的记忆"

### 配置（可选）

想调整效果？编辑 `config.toml`：

```toml
# 群聊
group_message_threshold = 50          # 多少条消息触发一次
group_time_interval_hours = 6         # 或多少小时触发一次
group_today_max_words = 1500          # 今天记忆最多多少字

# 私聊
private_message_threshold = 30
private_time_interval_hours = 12
private_today_max_words = 1000
```

---

## 效果对比

### 没有记忆的 AI

```
User: 还记得前天我们讨论的方案吗？
AI: 抱歉，我不太记得...能再说一遍吗？
```

### 有记忆的 AI

```
User: 还记得前天我们讨论的方案吗？
AI: 记得呀！你们那时候是在讨论用 React 还是 Vue。
    我印象中大家最后倾向于用 React，因为...
    （自然接上之前的讨论）
```

---

## 三层记忆结构

| 时间 | 详细度 | 用途 |
|------|--------|------|
| 📅 **今天** | 完整 | 当前的对话细节，保留所有重点 |
| 📅 **昨天** | 简略 | 关键信息浓缩，整理成概括 |
| 📅 **前天** | 极简 | 只记最重要的事，高度概括 |

三层记忆 = 完整上下文（最近的细节 + 历史的背景）

---

## 常见问题

**Q: 会不会影响回复速度？**  
A: 不会。记忆生成是后台异步进行，回复时只需注入已生成的内容。

**Q: 数据存在哪里？**  
A: 存在 `plugins/continuous_diary/data/` 目录，按对话 ID 和日期分文件保存。

**Q: 关机了会不会丢数据？**  
A: 不会。Bot 重启后会自动补全缺失的记忆版本，数据完全持久化。

**Q: 能否为不同对话设置不同配置？**  
A: 暂不支持。目前按群聊/私聊统一配置。

---

## 背后的逻辑

### 时间感知
- **早上 (0-8 点)** → 记忆用 33% 字数
- **中午 (8-16 点)** → 记忆用 67% 字数  
- **晚上 (16-24 点)** → 记忆用 100% 字数

这样对话少的时间段，记忆不会过于冗长。

### 自动管理
- 每天零点 → "今天的记忆"自动转为"昨天的记忆"
- 满足触发条件 → 自动生成新的"今天记忆"
- Bot 关机 → 恢复时自动补全缺失的版本

---

## 核心特点

✨ **第一人称** — 用"我"的视角记录，融合人设  
📚 **时间分层** — 近期详细，历史简略  
⚡ **自动触发** — 消息数或时间，任一即发  
🔄 **零点合并** — 每天自动整理前一天的记忆  
💾 **完全持久** — 数据永不丢失，重启自动恢复  

---

**让 AI 像真实的人一样记忆生活** 🧠

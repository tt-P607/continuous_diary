# 短期记忆 📝

> 补全 AI 的短期记忆连续性。记住最近 1-3 天的对话，让 AI 像真实的人一样自然接上之前的话题，而不是每次都像陌生人一样重新开始。

**Author**: MoFox-Studio

---

## 为什么需要这个？

### 问题
- ❌ AI 只能看到最近的 N 条消息
- ❌ 前几天说过的事情，都忘了
- ❌ 每次都得重新解释背景
- ❌ 没有"真实记忆"的感觉

### 解决方案
- ✅ 自动记住最近 **3 天** 的对话
- ✅ 用 **第一人称** 记录（像日记一样）
- ✅ 每次回复 **自动注入** 记忆内容
- ✅ AI 自然接上之前的话题，毫无违和感

---

## 怎么用？

### 开箱即用
安装后无需配置，自动生效。插件会：

1. **累积消息** → 收集最近的对话
2. **自动触发** → 达到条件时生成记忆总结
3. **注入提示词** → 下次 AI 回复时，自动融入这些记忆
4. **启动补全** → 启动时自动检查并补全缺失的历史日记

### 命令

| 命令 | 说明 |
|------|------|
| `/diary` | 查看日记状态（三天概要 + 待处理消息数） |
| `/diary refresh` | 强制刷新所有日记 |

### 配置（可选）

想调整效果？编辑 `config.toml`：

```toml
# 群聊
group_message_threshold = 50          # 多少条消息触发一次
group_time_interval_hours = 6         # 或多少小时触发一次
group_today_max_words = 2000          # 今天记忆最多多少字

# 私聊
private_message_threshold = 30
private_time_interval_hours = 12
private_today_max_words = 1500
```

---

## 三层记忆结构

| 时间 | 详细度 | 用途 |
|------|--------|------|
| 📅 **今天** | 完整 | 当前的对话细节，保留所有重点 |
| 📅 **昨天** | 简略 | 关键信息浓缩，整理成概括 |
| 📅 **前天** | 极简 | 只记最重要的事，高度概括 |

三层记忆 = 完整上下文（最近的细节 + 历史的背景）

---

## 效果对比

### 没有记忆的 AI

```
User: 还记得前天我们讨论的方案吗？
AI: 抱歉，我不太记得...能再说一遍吗？
```

### 有记忆的 AI

```
User: 还记得前天我们讨论的方案吗？
AI: 记得呀！你们那时候是在讨论用 React 还是 Vue。
    我印象中大家最后倾向于用 React，因为...
    （自然接上之前的讨论）
```

---

## 常见问题

**Q: 会不会影响回复速度？**  
A: 不会。记忆生成是后台异步进行，回复时只需注入已生成的内容。

**Q: 数据存在哪里？**  
A: 存在 `plugins/continuous_diary/data/` 目录，按对话类型和日期分文件保存。

**Q: 关机了会不会丢数据？**  
A: 不会。Bot 重启后会自动检查并补全缺失的历史日记。

**Q: 能否为不同对话设置不同配置？**  
A: 暂不支持。目前按群聊/私聊统一配置。

---

## 核心特点

✨ **第一人称** — 用"我"的视角记录，融合人设  
📚 **时间分层** — 近期详细，历史简略  
⚡ **自动触发** — 消息数或时间，任一即发  
🔄 **启动补全** — 重启自动检查并补全历史  
💾 **完全持久** — 数据永不丢失，每天独立存储  

---

**让 AI 像真实的人一样记忆生活** 🧠
